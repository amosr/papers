%!TEX root = ../Main.tex

\begin{figure*}


$$
\boxed{\Typecheck{\Gamma}{\mi{Exp}}{\TauMode}}
$$


$$
\ruleIN
{
    (x~:~\tau)~\in~\Gamma
}
{ 
    \Typecheck{\Gamma}{x}{\tau}
}{TcVar}
\ruleIN
{
  v~\in~\mathbb{N}
}
{ 
    \Typecheck{\Gamma}{v}{\NN}
}{TcNat}
\ruleIN
{
  \Typecheck{\Gamma}{e}{\tau}
  \quad
  \tau~\in~T
  \quad
  m~\in~\{@Element@,~@Aggregate@\}
}
{ 
    \Typecheck{\Gamma}{e}{m~\tau}
}{TcBox}
$$

$$
\ruleIN
{
    \TypecheckP{p}{\tau_\to}
    \quad
    \{ \Typecheck{\Gamma}{e_i}{\tau_i} \}
    \quad
    \TypecheckApp{\tau_\to}{\{\tau_i\}}{\tau'}
}
{ 
    \Typecheck{\Gamma}{p~\{e_i\}}{\tau'}
}{TcPrimApp}
\ruleIN
{
    (x~:~\tau_\to)~\in~\Gamma
    \quad
    \{ \Typecheck{\Gamma}{e_i}{\tau_i} \}
    \quad
    \TypecheckApp{\tau_\to}{\{\tau_i\}}{\tau'}
}
{ 
    \Typecheck{\Gamma}{x~\{e_i\}}{\tau'}
}{TcFunApp}
$$

$$
\ruleIN
{
  \Typecheck{\Gamma}{e}{\tau}
  \quad
  \Typecheck{\Gamma,~x:\tau}{e'}{\tau'}
}
{
  \Typecheck{\Gamma}{@let@~x~=~e~@in@~e'}{\tau'}
}{TcLet}
\ruleIN
{
  \Typecheck{\Gamma}{e_z}{\tau}
  \quad
  \tau~\in~T
  \quad
  \Typecheck{\Gamma,~x:@Element@~\tau}{e_k}{@Element@~\tau}
}
{
  \Typecheck{\Gamma}{@fold@~x~=~e_z~@then@~e_k}{@Aggregate@~\tau}
}{TcFold}
$$

$$
\ruleIN
{
  \Typecheck{\Gamma}{e}{@Element@~\BB}
  \quad
  \Typecheck{\Gamma}{e'}{@Aggregate@~\tau}
}
{
  \Typecheck{\Gamma}{@filter@~e~@of@~e'}{@Aggregate@~\tau}
}{TcFilter}
\ruleIN
{
  \Typecheck{\Gamma}{e}{@Element@~\tau}
  \quad
  \Typecheck{\Gamma}{e'}{@Aggregate@~\tau'}
}
{
  \Typecheck{\Gamma}{@group@~e~@of@~e'}{@Aggregate@~(@Map@~\tau~\tau')}
}{TcGroup}
$$


$$
\boxed{\TypecheckP{\mi{Prim}}{\TauFun}}
$$

$$
\ruleIN
{
  p~\in~\{@+@,~@-@,~@*@,~@/@\}
}
{
  \TypecheckP{p}{\NN~\to~\NN~\to~\NN}
}{PrimArith}
\ruleIN
{
  p~\in~\{@==@,~@/=@,~@<@,~@>@\}
}
{
  \TypecheckP{p}{\NN~\to~\NN~\to~\BB}
}{PrimRel}
\ruleAx
{
  \TypecheckP{@mapLookup@}{@Map@~\tau~\tau'~\to~\tau~\to~\tau'}
}{PrimLookup}
$$

$$
\boxed{\TypecheckApp{\TauFun}{\ov{\TauMode}}{\TauMode}}
$$

$$
\ruleIN
{
}
{
  \TypecheckApp{(\{\tau_i~\to\}~\tau')}{\{\tau_i\}}{\tau'}
}{AppArgs}
\ruleIN
{
  \{\tau_i~\in~T\}
  \quad
  \tau'~\in~T
}
{
  \TypecheckApp{(\{\tau_i~\to\}~\tau')}{\{m~\tau_i\}}{m~\tau'}
}{AppRebox}
$$

$$
\boxed{\TypecheckS{\Gamma}{\mi{Def}}{\Gamma}}
$$

$$
\ruleIN
{
  \Typecheck{\{x_i:\tau_i\}~\cup~\Gamma}{e}{\tau'}
  \quad
  \tau_\to~=~\{\tau_i~\to\}~\tau'
}
{
  \TypecheckS{\Gamma}{@function@~x~\{x_i~:~\tau_i\}~=~e}{\Gamma,~x:\tau_\to}
}{CheckFun}
\ruleIN
{
  \Typecheck{\Gamma}{e}{@Aggregate@~\tau}
}
{
  \TypecheckS{\Gamma}{@query@~x~=~e}{\Gamma,~x:~@Aggregate@~\tau}
}{CheckQuery}
$$

$$
\boxed{\TypecheckS{}{\mi{Top}}{\Gamma}}
$$

$$
\ruleIN
{
  \Gamma_0~=~\{x_i:@Element@~\tau_i\}
  \quad
  \{~\TypecheckS{\Gamma_{j-1}}{d_j}{\Gamma_j}~\}
}
{
  \TypecheckS
    {}
    {
      @table@
      ~x~\{x_i~:~\tau_i\};
      ~\{~d_j~\}
    }
    {\Gamma_j}
}{CheckTop}
$$


\caption{Types of expressions}
\label{fig:source:type:exp}
\end{figure*}

