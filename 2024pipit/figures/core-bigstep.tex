%!TEX root = ../Main.tex

\begin{figure}[t]
  \begin{mathpar}
    \boxed{\bigstep{\Sigma}{e}{v}}
  \end{mathpar}
  \begin{mathpar}
    \ruleAx{\bigstep{\Sigma; \sigma}{x}{\sigma(x)}}{Var}
    \quad
    \ruleAx{\bigstep{\Sigma}{v}{v}}{Value}

    \ruleIN{
      \bigstep{\Sigma}{e'[x := e]}{v}
    }{
      \bigstep{\Sigma}{\xlet{x}{e}{e'[x]}}{v}
    }{Let}

    \ruleIN{
      \bigstep{\Sigma}{e_1}{v_1} \quad \hdots \quad
      \bigstep{\Sigma}{e_n}{v_n}
    }{\bigstep{\Sigma}{p(\ov{e})}{\text{prim-sem}(p, \ov{v})}}{Prim}


    % \[
  %   \ruleIN{\bigstep{\Sigma}{e}{v}}{\bigstep{\Sigma; \sigma}{\xpre{e}}{v}}{Pre}
  % \]

  \ruleAx{\bigstep{\sigma}{\xfby{v}{e'}}{v}}{$\mbox{Fby}_1$}
    \quad
    \ruleIN{\text{length}(\Sigma) > 0 \and \bigstep{\Sigma}{e'}{v'}}{\bigstep{\Sigma; \sigma}{\xfby{v}{e'}}{v'}}{$\mbox{Fby}_S$}

    % \ruleIN{\bigstep{\sigma}{e}{v}}{\bigstep{\sigma}{\xthen{e}{e'}}{v}}{$\xthenarrow_1$}
    % \quad
    % \ruleIN{\bigstep{\Sigma}{e'}{v'}}{\bigstep{\Sigma; \sigma}{\xthen{e}{e'}}{v'}}{$\xthenarrow_S$}

    \ruleIN{
      \bigstep{\Sigma}{e[x := \xrec{x}{e}]}{v}
    }{
      \bigstep{\Sigma}{\xrec{x}{e[x]}}{v}
    }{Rec}

    \ruleIN{
      % \bigstep{\Sigma}{e}{\top}
    }{
      \bigstep{\Sigma}{\xcheckP{\PStatus}{e}}{()}
    }{Check}

    \ruleIN{
      \bigstep{\Sigma}{\ebody}{v}
    }{
      \bigstep{\Sigma}{\xcontractP{\PStatus}{\erely}{\ebody}{\rawbind{x}{\eguar[x]}}}{v}
    }{Contract}
  \end{mathpar}

  \begin{mathpar}
    \boxed{\bigsteps{\Sigma}{e}{V}}

    \boxed{\bigstepalways{\Sigma}{e}}
  \end{mathpar}
  \begin{mathpar}
    \ruleAx{\bigsteps{\cdot}{e}{\cdot}}{$\mbox{Steps}_0$}
    % \ruleIN{\bigstep{\sigma}{e}{v}}{\bigsteps{\sigma}{e}{v}}{$\mbox{Steps}_1$}

    \ruleIN{
      \bigstep{\Sigma}{e}{V}
      \and
      \bigstep{\Sigma; \sigma}{e}{v}
    }{\bigstep{\Sigma; \sigma}{e}{V; v}}{$\mbox{Steps}_S$}

    \ruleIN{\bigsteps{\Sigma}{e}{\true; \hdots}}{\bigstepalways{\Sigma}{e}}{Always}
  \end{mathpar}


  \caption{Dynamic semantics for Pipit; the judgment form $\bigstep{\Sigma}{e}{v}$ denotes that evaluating expression $e$ under streaming history $\Sigma$ results in value $v$.}\label{f:core-bigstep}
\end{figure}
