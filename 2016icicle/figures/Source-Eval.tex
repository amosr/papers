%!TEX root = ../Main.tex

\begin{figure*}

$$
\boxed{\SourceStepZ{e}{\mi{acc}}{\mi{res}}}
$$

$$
\ruleAx
{
    \SourceStepZ{x}{()}{x}
}{ZVar}
\ruleAx
{
    \SourceStepZ{v}{()}{v}
}{ZValue}
\ruleIN
{
    \SourceStepZ{e}{a}{r}
}
{
    \SourceStepZ{\lambda{}x~:~\tau.~e}{a}{\lambda{}x~:~\tau.~r}
}{ZLam}
$$

$$
\ruleAx
{
    \SourceStepZ{\langle e_1 e_2 \rangle}{\langle e_1 e_2 \rangle}{\bot}
}{ZStream1}
\ruleAx
{
    \SourceStepZ{\langle \rangle}{\langle \rangle}{\bot}
}{ZStream2}
\ruleIN
{
    \SourceStepZ{e_1}{a_1}{r_1}
    \quad
    \SourceStepZ{e_2}{a_2}{r_2}
}
{
    \SourceStepZ{@when@~e_1~e_2}{a_1,a_2}{r_2}
}{ZWhen}
\ruleIN
{
    \SourceStepZ{e_1}{a_1}{r_1}
    \quad
    \SourceStepZ{e_2}{a_2}{r_2}
}
{
    \SourceStepZ{@sample@~e_1~e_2}{a_1,a_2}{\bot}
}{ZSample}
$$

$$
\ruleIN
{
    \SourceStepZ{e}{a}{r}
}
{
    \SourceStepZ{@mapS@~f~e}{a}{\bot}
}{ZMapS}
\ruleIN
{
    \SourceStepZ{e_1}{a_1}{r_1}
    \quad
    \SourceStepZ{e_2}{a_2}{r_2}
}
{
    \SourceStepZ{@zipS@~e_1~e_2}{a_1,a_2}{\bot}
}{ZZipS}
$$

$$
\ruleIN
{
    \SourceStepZ{e}{a}{r}
}
{
    \SourceStepZ{@mapF@~f~e}{a}{f~r}
}{ZMapF}
\ruleIN
{
    \SourceStepZ{e_1}{a_1}{r_1}
    \quad
    \SourceStepZ{e_2}{a_2}{r_2}
}
{
    \SourceStepZ{@zipF@~e_1~e_2}{a_1,a_2}{r_1,r_2}
}{ZZipF}
$$

$$
\boxed{\SourceStepK{\mi{acc}}{e}{\mi{acc}}{\mi{res}}}
$$

$$
\boxed{\SourceStepX{e}{e}}
$$

$$
\ruleIN
{
    \SourceStepX{e_1}{e_1'}
}
{
    \SourceStepX{e_1~e_2}{e_1'~e_2}
}{XApp1}
\ruleIN
{
    \SourceStepX{e_2}{e_2'}
}
{
    \SourceStepX{v_1~e_2}{v_1~e_2'}
}{XApp2}
\ruleAx
{
    \SourceStepX{(\lambda{}x.~e_1)~e_2}{e_1[x:=e_2]}
}{XApp3}
$$
$$
\ruleIN
{
    \SourceStepX{e_1}{e_1'}
}
{
    \SourceStepX{@let@~x~=~e_1~@in@~e_2}{@let@~x~=~e_1'~@in@~e_2}
}{XLet1}
\ruleAx
{
    \SourceStepX{@let@~x~=~v_1~@in@~e_2}{e_2[x:=v_1]}
}{XLet2}
$$

\caption{Evaluation rules}
\label{fig:source:eval}
\end{figure*}


