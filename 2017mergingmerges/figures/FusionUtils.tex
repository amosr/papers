
\begin{figure}

\begin{tabbing}
$\ChanType_2$   \TABDEF \kill

\ti{channels} \> $:$ \> $\Proc \to \Proc \to \MapType{\Chan}{\ChanType_2}$ \\

  \> $=$    \> $\{ c=@MMMMMMM@~$\= \kill
$\ti{channels}~p~q$
  \> $=$    \> $\{ c=@in2@$
            \> $|~c~\in~(@ins@~p~\cap~@ins@~q) \}$ \\

  \> $\cup$ \> $\{ c=@in1@$
            \> $ |~c~\in~(@ins@~p~\cup~@ins@~q)~\wedge~c~\not\in(@outs@~p~\cup~@outs@~q) \}$ \\

  \> $\cup$ \> $\{ c=@in1out1@$
            \> $|~c~\in~(@ins@~p~\cup~@ins@~q)~\wedge~c~\in(@outs@~p~\cup~@outs@~q) \}$ \\

  \> $\cup$ \> $\{ c=@out1@$
            \> $ |~c~\not\in~(@ins@~p~\cup~@ins@~q)~\wedge~c~\in(@outs@~p~\cup~@outs@~q) \}$ \\
\\

\ti{connected} \> $:$ \> $\Proc \to \Proc \to  \mathbb{B}$ \\
$\ti{connected}~p~q$
  \> $=$ \> $(@ins@~p~\cup~@outs@~p)~\cap~(@ins@~q~\cup~@outs@~q)~\not\eq~\sgl{}$ \\
\end{tabbing}

\newcommand\funClauseDef[3]
{ $\ti{#1}~(#2)$ \> $=$ \> $#3$ \\
}
\newcommand\outlabelsDef[2]
{ \funClauseDef{outlabels}{#1}{\sgl{#2}} 
}

\begin{tabbing}
$\ti{outlabels}~(@case@~e~l_t[u_t]~l_t[u_f])$ \TABSKIP $=$ \TABSKIP \kill
\ti{outlabels} \> $~:$ \> $\Instr \to \sgl{\Label}$ \\
\outlabelsDef{@pull@~c~x~l[u]}{l}
\outlabelsDef{@drop@~c~l[u]}{l}
\outlabelsDef{@push@~c~e~l[u]}{l}
\outlabelsDef{@case@~e~l[u]~l'[u']}{l, l'}
\outlabelsDef{@jump@~l[u]}{l}
\end{tabbing}

\begin{tabbing}
$\ti{swaplabel}~(@case@~e~l_t[u_t]~l_t[u_f])$ \TABSKIP $=$ \TABSKIP \kill
\ti{swaplabel} \> $~:$ \> $\Label \to \Label$ \\
$\ti{swaplabel}~(@label@'~l_1~l_2)$ \> $=$ \> $@label@'~l_2~l_1$ \\
\end{tabbing}

\begin{tabbing}
$\ti{swaplabels}~(@case@~e~l_t[u_t]~l_t[u_f])$ \TABSKIP $=$ \TABSKIP \kill
\ti{swaplabels} \> $~:$ \> $\Instr \to \Instr$ \\
\funClauseDef{swaplabels}{@pull@~c~x~l[u]}{@pull@~c~x~(\ti{swaplabel}~l)[u]}
\funClauseDef{swaplabels}{@drop@~c~l[u]}{@drop@~c~(\ti{swaplabel}~l)[u]}
\funClauseDef{swaplabels}{@push@~c~e~l[u]}{@push@~c~e~(\ti{swaplabel}~l)[u]}
\funClauseDef{swaplabels}{@case@~e~l[u]~l'[u']}{@case@~e~(\ti{swaplabel}~l)[u]~(\ti{swaplabel}~l')[u']}
\funClauseDef{swaplabels}{@jump@~l[u]}{@jump@~(\ti{swaplabel}~l)[u]}
\end{tabbing}

\caption{Utility functions}
\label{fig:Fusion:Utils}
\end{figure}

